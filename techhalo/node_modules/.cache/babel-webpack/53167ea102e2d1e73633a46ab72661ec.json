{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { Category } from '../../common/Category';\nimport { Supplier } from '../../common/Supplier';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"../../services_admin/category.service\";\nimport * as i3 from \"../../services_admin/product.service\";\nimport * as i4 from \"src/app/services_admin/supplier.service\";\nimport * as i5 from \"src/app/services_admin/purchase-order-detail.service\";\nimport * as i6 from \"ngx-toastr\";\nimport * as i7 from \"../../services_admin/upload.service\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/forms\";\nimport * as i10 from \"@angular/common\";\nfunction AddProductComponent_Admin_ng_template_0_option_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 32);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r7.supplierId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r7.name);\n  }\n}\nfunction AddProductComponent_Admin_ng_template_0_option_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 32);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r8 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r8.categoryId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r8.categoryName);\n  }\n}\nfunction AddProductComponent_Admin_ng_template_0_div_45_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 33);\n    i0.ɵɵelementStart(1, \"div\", 34);\n    i0.ɵɵelement(2, \"img\", 35);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 25);\n    i0.ɵɵelementStart(4, \"input\", 36);\n    i0.ɵɵlistener(\"change\", function AddProductComponent_Admin_ng_template_0_div_45_Template_input_change_4_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r12);\n      const i_r10 = restoredCtx.index;\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return ctx_r11.onFileSelect($event, i_r10 + 2);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(5, \"label\", 37);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const img_r9 = ctx.$implicit;\n    const i_r10 = ctx.index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"alt\", \"\\u1EA2nh s\\u1EA3n ph\\u1EA9m \", i_r10 + 2, \"\");\n    i0.ɵɵproperty(\"src\", img_r9, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"customFile\", i_r10 + 2, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate1(\"for\", \"customFile\", i_r10 + 2, \"\");\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"is-invalid\": a0\n  };\n};\nconst _c1 = function (a0, a1, a2, a3) {\n  return [a0, a1, a2, a3];\n};\nfunction AddProductComponent_Admin_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"h2\", 3);\n    i0.ɵɵtext(2, \"Th\\u00EAm s\\u1EA3n ph\\u1EA9m\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 4);\n    i0.ɵɵelementStart(4, \"form\", 5);\n    i0.ɵɵelement(5, \"input\", 6);\n    i0.ɵɵelement(6, \"input\", 7);\n    i0.ɵɵelement(7, \"input\", 8);\n    i0.ɵɵelementStart(8, \"div\", 9);\n    i0.ɵɵelementStart(9, \"label\", 10);\n    i0.ɵɵtext(10, \"T\\u00EAn s\\u1EA3n ph\\u1EA9m\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(11, \"input\", 11);\n    i0.ɵɵelementStart(12, \"small\", 12);\n    i0.ɵɵtext(13, \"T\\u00EAn s\\u1EA3n ph\\u1EA9m kh\\u00F4ng h\\u1EE3p l\\u1EC7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 9);\n    i0.ɵɵelementStart(15, \"label\", 13);\n    i0.ɵɵtext(16, \"Nh\\u00E0 cung c\\u1EA5p\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"select\", 14);\n    i0.ɵɵtemplate(18, AddProductComponent_Admin_ng_template_0_option_18_Template, 2, 2, \"option\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"small\", 12);\n    i0.ɵɵtext(20, \"Nh\\u00E0 cung c\\u1EA5p kh\\u00F4ng h\\u1EE3p l\\u1EC7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"div\", 16);\n    i0.ɵɵelementStart(22, \"label\", 17);\n    i0.ɵɵtext(23, \"Lo\\u1EA1i h\\u00E0ng\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"select\", 18);\n    i0.ɵɵtemplate(25, AddProductComponent_Admin_ng_template_0_option_25_Template, 2, 2, \"option\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"small\", 12);\n    i0.ɵɵtext(27, \"Lo\\u1EA1i h\\u00E0ng kh\\u00F4ng h\\u1EE3p l\\u1EC7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"div\", 9);\n    i0.ɵɵelementStart(29, \"label\", 19);\n    i0.ɵɵtext(30, \"M\\u00F4 t\\u1EA3 s\\u1EA3n ph\\u1EA9m\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(31, \"textarea\", 20);\n    i0.ɵɵelementStart(32, \"small\", 12);\n    i0.ɵɵtext(33, \"Kh\\u00F4ng h\\u1EE3p l\\u1EC7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"div\", 21);\n    i0.ɵɵelementStart(35, \"label\");\n    i0.ɵɵtext(36, \"\\u1EA2nh s\\u1EA3n ph\\u1EA9m\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"div\", 22);\n    i0.ɵɵelementStart(38, \"div\", 23);\n    i0.ɵɵelement(39, \"img\", 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"div\", 25);\n    i0.ɵɵelementStart(41, \"input\", 26);\n    i0.ɵɵlistener(\"change\", function AddProductComponent_Admin_ng_template_0_Template_input_change_41_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.onFileSelect($event, 1);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(42, \"label\", 27);\n    i0.ɵɵtext(43, \"Ch\\u1ECDn \\u1EA3nh ch\\u00EDnh\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(44, \"div\", 28);\n    i0.ɵɵtemplate(45, AddProductComponent_Admin_ng_template_0_div_45_Template, 6, 4, \"div\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(46, \"div\", 30);\n    i0.ɵɵelementStart(47, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function AddProductComponent_Admin_ng_template_0_Template_button_click_47_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.save();\n    });\n    i0.ɵɵtext(48, \"Th\\u00EAm\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    let tmp_1_0;\n    let tmp_4_0;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.postForm);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c0, ((tmp_1_0 = ctx_r1.postForm.get(\"name\")) == null ? null : tmp_1_0.touched) && ((tmp_1_0 = ctx_r1.postForm.get(\"name\")) == null ? null : tmp_1_0.invalid)));\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.suppliers);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.categories);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(10, _c0, ((tmp_4_0 = ctx_r1.postForm.get(\"description\")) == null ? null : tmp_4_0.touched) && ((tmp_4_0 = ctx_r1.postForm.get(\"description\")) == null ? null : tmp_4_0.invalid)));\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"src\", ctx_r1.image, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpureFunction4(12, _c1, ctx_r1.image2, ctx_r1.image3, ctx_r1.image4, ctx_r1.image5));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.postForm.invalid);\n  }\n}\nexport let AddProductComponent_Admin = /*#__PURE__*/(() => {\n  class AddProductComponent_Admin {\n    constructor(modalService, categoryService, productService, supplierService, purchaseOrderDetailsService, toastr, uploadService) {\n      this.modalService = modalService;\n      this.categoryService = categoryService;\n      this.productService = productService;\n      this.supplierService = supplierService;\n      this.purchaseOrderDetailsService = purchaseOrderDetailsService;\n      this.toastr = toastr;\n      this.uploadService = uploadService;\n      this.selectedFiles = [];\n      this.urls = [];\n      this.purchaseOrderDetail = null; // Thông tin giá gốc\n      this.quantityPurchaseOrderDetail = null; // Thông tin số lượng gốc\n      // Declare image variables\n      this.image = 'https://res.cloudinary.com/techhalo/image/upload/v1730081981/techhalo/pzjqsq33ethm4dsgxde8.jpg';\n      this.image2 = 'https://res.cloudinary.com/techhalo/image/upload/v1730081981/techhalo/pzjqsq33ethm4dsgxde8.jpg';\n      this.image3 = 'https://res.cloudinary.com/techhalo/image/upload/v1730081981/techhalo/pzjqsq33ethm4dsgxde8.jpg';\n      this.image4 = 'https://res.cloudinary.com/techhalo/image/upload/v1730081981/techhalo/pzjqsq33ethm4dsgxde8.jpg';\n      this.image5 = 'https://res.cloudinary.com/techhalo/image/upload/v1730081981/techhalo/pzjqsq33ethm4dsgxde8.jpg';\n      this.saveFinish = new EventEmitter();\n      this.postForm = new FormGroup({\n        'productId': new FormControl(0),\n        'name': new FormControl(null, [Validators.minLength(4), Validators.required]),\n        // 'quantity': new FormControl(0, [Validators.min(0), Validators.required]),\n        // 'originalPrice': new FormControl(null, [Validators.required]),\n        // 'price': new FormControl(null, [Validators.required, Validators.min(1000)]),\n        'discount': new FormControl(0, [Validators.required, Validators.min(0), Validators.max(100)]),\n        'description': new FormControl(null, Validators.required),\n        'enteredDate': new FormControl(new Date()),\n        'supplierId': new FormControl(0),\n        'categoryId': new FormControl(0),\n        'status': new FormControl(1),\n        'sold': new FormControl(0)\n      });\n    }\n    ngOnInit() {\n      this.getCategories();\n      this.getSuppliers();\n    }\n    // Lấy thông tin giá gốc (từ PurchaseOrderDetail)\n    loadPurchaseOrderDetail(productId) {\n      this.purchaseOrderDetailsService.getPrice(productId).subscribe(data => {\n        this.purchaseOrderDetail = data;\n      });\n    }\n    // Lấy thông tin số lượng gốc (từ PurchaseOrderDetail)\n    loadQuantityPurchaseOrderDetail(productId) {\n      this.purchaseOrderDetailsService.getQuantity(productId).subscribe(data => {\n        this.quantityPurchaseOrderDetail = data;\n      });\n    }\n    save() {\n      if (this.postForm.valid && this.urls.length === 5) {\n        this.product = this.postForm.value;\n        this.product.supplier = new Supplier(this.postForm.value.supplierId, '');\n        this.product.category = new Category(this.postForm.value.categoryId, '');\n        this.product.price = 0.0;\n        this.product.quantity = 0;\n        this.product.image = this.urls[0];\n        this.product.image2 = this.urls[1];\n        this.product.image3 = this.urls[2];\n        this.product.image4 = this.urls[3];\n        this.product.image5 = this.urls[4];\n        console.log(this.product);\n        this.productService.save(this.product).subscribe(data => {\n          this.toastr.success('Thêm thành công!', 'Hệ thống');\n          this.saveFinish.emit('done');\n        });\n      } else {\n        this.toastr.error('Thêm thất bại! Bạn cần upload 5 hình.', 'Hệ thống');\n      }\n      this.resetForm();\n      this.modalService.dismissAll();\n    }\n    resetForm() {\n      this.postForm.reset({\n        'productId': 0,\n        'name': null,\n        // 'quantity': this.product.quantity,\n        //  'originalPrice': this.product.price,\n        // 'price': null,\n        'discount': null,\n        'description': null,\n        'enteredDate': new Date(),\n        'supplierId': 1,\n        'categoryId': 1,\n        'status': 1,\n        'sold': 0\n      });\n      this.urls = [];\n      this.image = '';\n      this.image2 = '';\n      this.image3 = '';\n      this.image4 = '';\n      this.image5 = '';\n    }\n    getCategories() {\n      this.categoryService.getAll().subscribe(data => {\n        this.categories = data;\n      }, error => {\n        this.toastr.error('Lỗi truy xuất dữ liệu, bấm f5!', 'Hệ thống');\n      });\n    }\n    getSuppliers() {\n      this.supplierService.getAllSup().subscribe(data => {\n        this.suppliers = data;\n      }, error => {\n        this.toastr.error('Lỗi truy xuất dữ liệu, bấm f5!', 'Hệ thống');\n      });\n    }\n    onFileSelect(event, imageIndex) {\n      const file = event.target.files[0];\n      if (!file) return;\n      this.uploadService.uploadProduct(file).subscribe(response => {\n        if (response && response.secure_url) {\n          switch (imageIndex) {\n            case 1:\n              this.image = response.secure_url;\n              this.urls[0] = response.secure_url;\n              break;\n            case 2:\n              this.image2 = response.secure_url;\n              this.urls[1] = response.secure_url;\n              break;\n            case 3:\n              this.image3 = response.secure_url;\n              this.urls[2] = response.secure_url;\n              break;\n            case 4:\n              this.image4 = response.secure_url;\n              this.urls[3] = response.secure_url;\n              break;\n            case 5:\n              this.image5 = response.secure_url;\n              this.urls[4] = response.secure_url;\n              break;\n          }\n        }\n      }, error => {\n        this.toastr.error('Lỗi khi tải lên hình ảnh.', 'Hệ thống');\n      });\n    }\n    open(content) {\n      this.modalService.open(content, {\n        centered: true,\n        size: 'lg'\n      });\n    }\n  }\n  AddProductComponent_Admin.ɵfac = function AddProductComponent_Admin_Factory(t) {\n    return new (t || AddProductComponent_Admin)(i0.ɵɵdirectiveInject(i1.NgbModal), i0.ɵɵdirectiveInject(i2.CategoryService), i0.ɵɵdirectiveInject(i3.ProductService), i0.ɵɵdirectiveInject(i4.SupplierService), i0.ɵɵdirectiveInject(i5.PurchaseOrderDetailsService), i0.ɵɵdirectiveInject(i6.ToastrService), i0.ɵɵdirectiveInject(i7.UploadService));\n  };\n  AddProductComponent_Admin.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddProductComponent_Admin,\n    selectors: [[\"app-add-product\"]],\n    outputs: {\n      saveFinish: \"saveFinish\"\n    },\n    decls: 4,\n    vars: 0,\n    consts: [[\"content\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"modal-header\"], [1, \"modal-title\", \"m-0\"], [1, \"modal-body\", \"p-4\"], [1, \"row\", 3, \"formGroup\"], [\"type\", \"hidden\", \"formControlName\", \"productId\"], [\"type\", \"hidden\", \"formControlName\", \"status\"], [\"type\", \"hidden\", \"formControlName\", \"sold\"], [1, \"form-group\", \"col-6\"], [\"for\", \"name\"], [\"type\", \"text\", \"id\", \"name\", \"formControlName\", \"name\", 1, \"form-control\", 3, \"ngClass\"], [1, \"invalid-feedback\"], [\"for\", \"supplier\"], [\"id\", \"supplier\", \"formControlName\", \"supplierId\", 1, \"form-control\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"form-group\", \"col-12\"], [\"for\", \"category\"], [\"id\", \"category\", \"formControlName\", \"categoryId\", 1, \"form-control\"], [\"for\", \"description\"], [\"id\", \"description\", \"rows\", \"12\", \"formControlName\", \"description\", 1, \"form-control\", 3, \"ngClass\"], [1, \"form-group\", \"col-6\", \"text-center\"], [1, \"text-center\"], [1, \"main-image-wrapper\"], [\"alt\", \"\\u1EA2nh s\\u1EA3n ph\\u1EA9m ch\\u00EDnh\", 1, \"img-fluid\", \"main-image\", 3, \"src\"], [1, \"custom-file\", \"mt-2\"], [\"type\", \"file\", \"id\", \"mainImageFile\", 1, \"custom-file-input\", 3, \"change\"], [\"for\", \"mainImageFile\", 1, \"custom-file-label\", \"form-control\"], [1, \"row\", \"mt-3\", \"justify-content-center\"], [\"class\", \"col-3 text-center\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-2\", \"text-center\", \"mt-4\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 1, \"form-control\", 3, \"disabled\", \"click\"], [3, \"value\"], [1, \"col-3\", \"text-center\"], [1, \"image-wrapper\"], [1, \"img-fluid\", \"product-thumbnail\", 3, \"src\", \"alt\"], [\"type\", \"file\", 1, \"custom-file-input\", 3, \"id\", \"change\"], [1, \"custom-file-label\", \"mt\", \"form-control\", 3, \"for\"]],\n    template: function AddProductComponent_Admin_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r16 = i0.ɵɵgetCurrentView();\n        i0.ɵɵtemplate(0, AddProductComponent_Admin_ng_template_0_Template, 49, 17, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementStart(2, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AddProductComponent_Admin_Template_button_click_2_listener() {\n          i0.ɵɵrestoreView(_r16);\n          const _r0 = i0.ɵɵreference(1);\n          return ctx.open(_r0);\n        });\n        i0.ɵɵtext(3, \"Th\\u00EAm s\\u1EA3n ph\\u1EA9m\");\n        i0.ɵɵelementEnd();\n      }\n    },\n    directives: [i8.MatButton, i9.ɵNgNoValidate, i9.NgControlStatusGroup, i9.FormGroupDirective, i9.DefaultValueAccessor, i9.NgControlStatus, i9.FormControlName, i10.NgClass, i9.SelectControlValueAccessor, i10.NgForOf, i9.NgSelectOption, i9.ɵNgSelectMultipleOption],\n    styles: [\".main-image-wrapper[_ngcontent-%COMP%]{width:150px;height:150px;margin:0 auto;overflow:hidden}.main-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.image-wrapper[_ngcontent-%COMP%]{width:80px;height:80px;overflow:hidden;margin:0 auto}.product-thumbnail[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}\"]\n  });\n  return AddProductComponent_Admin;\n})();","map":null,"metadata":{},"sourceType":"module"}