{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-toastr\";\nimport * as i2 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i3 from \"src/app/services/promotions.service\";\nimport * as i4 from \"src/app/services/cart.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../../pipes/currency-vietnam.pipe\";\nfunction ApplyPromotionCartComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵelementStart(1, \"p\");\n    i0.ɵɵtext(2, \"Kh\\u00F4ng c\\u00F3 m\\u00E3 gi\\u1EA3m gi\\u00E1 n\\u00E0o s\\u1EB5n c\\u00F3 cho b\\u1EA1n.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ApplyPromotionCartComponent_div_8_div_1_strong_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"strong\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const promotion_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", promotion_r3.discount, \"%\");\n  }\n}\nfunction ApplyPromotionCartComponent_div_8_div_1_strong_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"strong\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"currencyVietnam\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const promotion_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, promotion_r3.discount));\n  }\n}\nfunction ApplyPromotionCartComponent_div_8_div_1_button_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function ApplyPromotionCartComponent_div_8_div_1_button_14_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const promotion_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return ctx_r11.onApplyPromotion(promotion_r3);\n    });\n    i0.ɵɵtext(1, \" \\u00C1p d\\u1EE5ng \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ApplyPromotionCartComponent_div_8_div_1_span_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 22);\n    i0.ɵɵtext(1, \"\\u0110\\u00E3 \\u00E1p d\\u1EE5ng\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ApplyPromotionCartComponent_div_8_div_1_p_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 23);\n    i0.ɵɵtext(1, \" M\\u00E3 gi\\u1EA3m gi\\u00E1 kh\\u00F4ng th\\u1EC3 \\u00E1p d\\u1EE5ng! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ApplyPromotionCartComponent_div_8_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelementStart(1, \"div\", 11);\n    i0.ɵɵelementStart(2, \"h5\", 12);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\", 13);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 14);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 15);\n    i0.ɵɵelementStart(9, \"p\", 16);\n    i0.ɵɵtext(10, \" Gi\\u1EA3m gi\\u00E1: \");\n    i0.ɵɵtemplate(11, ApplyPromotionCartComponent_div_8_div_1_strong_11_Template, 2, 1, \"strong\", 6);\n    i0.ɵɵtemplate(12, ApplyPromotionCartComponent_div_8_div_1_strong_12_Template, 3, 3, \"strong\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 17);\n    i0.ɵɵtemplate(14, ApplyPromotionCartComponent_div_8_div_1_button_14_Template, 2, 0, \"button\", 18);\n    i0.ɵɵtemplate(15, ApplyPromotionCartComponent_div_8_div_1_span_15_Template, 2, 0, \"span\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, ApplyPromotionCartComponent_div_8_div_1_p_16_Template, 2, 0, \"p\", 20);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const promotion_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(promotion_r3.code);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"HSD: \", ctx_r2.formatDate(promotion_r3.endDate), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(promotion_r3.description);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", promotion_r3.type === \"percentage\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", promotion_r3.type === \"fixed\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.isPromotionApplied(promotion_r3));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isPromotionApplied(promotion_r3));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.invalidPromotionId === promotion_r3.promotionCodeId);\n  }\n}\nfunction ApplyPromotionCartComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ApplyPromotionCartComponent_div_8_div_1_Template, 17, 8, \"div\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.availablePromotions);\n  }\n}\nexport let ApplyPromotionCartComponent = /*#__PURE__*/(() => {\n  class ApplyPromotionCartComponent {\n    constructor(toastr, modalService, promotionService, cartService) {\n      this.toastr = toastr;\n      this.modalService = modalService;\n      this.promotionService = promotionService;\n      this.cartService = cartService;\n      this.availablePromotions = [];\n      this.applyPromotion = new EventEmitter();\n      this.invalidPromotionId = null; // Track invalid promotion\n      this.appliedPromotions = []; // Track applied promotions\n    }\n    ngOnInit() {\n      const storedPromotions = sessionStorage.getItem('appliedPromotions');\n      this.appliedPromotions = storedPromotions ? JSON.parse(storedPromotions) : [];\n    }\n    formatDate(date) {\n      const formattedDate = new Date(date);\n      const day = formattedDate.getDate();\n      const month = formattedDate.getMonth() + 1; // getMonth() is zero-based\n      const year = formattedDate.getFullYear();\n      const monthNames = ['th1', 'th2', 'th3', 'th4', 'th5', 'th6', 'th7', 'th8', 'th9', 'th10', 'th11', 'th12']; // Vietnamese month names\n      return `${day} ${monthNames[month - 1]} ${year}`;\n    }\n    isPromotionApplied(promotion) {\n      return this.appliedPromotions.some(p => p.promotionCodeId === promotion.promotionCodeId);\n    }\n    isPromotionValid(promotion) {\n      const today = new Date();\n      const minOrderValue = promotion.minOrderValue;\n      const currentUses = promotion.currentUses;\n      const maxUses = promotion.maxUses;\n      const amount = this.amount;\n      console.log(amount);\n      if (new Date(promotion.endDate) < today) {\n        this.toastr.error(\"Mã giảm giá đã hết hạn!\", \"Lỗi\");\n        this.invalidPromotionId = promotion.promotionCodeId;\n        return false;\n      }\n      if (amount < minOrderValue) {\n        this.toastr.error(\"Số tiền đơn hàng chưa đạt yêu cầu tối thiểu!\", \"Lỗi\");\n        this.invalidPromotionId = promotion.promotionCodeId;\n        return false;\n      }\n      if (currentUses >= maxUses) {\n        this.toastr.warning(\"Số lần sử dụng mã giảm giá đã hết!\", \"Lỗi\");\n        this.invalidPromotionId = promotion.promotionCodeId;\n        return false;\n      }\n      this.invalidPromotionId = null;\n      return true;\n    }\n    onApplyPromotion(promotion) {\n      if (this.isPromotionValid(promotion)) {\n        console.log(promotion);\n        this.appliedPromotions.push(promotion); // Add to applied promotions\n        sessionStorage.setItem('appliedPromotionCode', promotion.code);\n        sessionStorage.setItem('appliedPromotionId', promotion.promotionCodeId.toString());\n        sessionStorage.setItem('appliedPromotionId', promotion.discount.toString());\n        this.applyPromotion.emit(promotion);\n        this.modalService.dismissAll();\n        this.toastr.success('Mã giảm giá đã được áp dụng!', 'Hệ thống');\n      }\n    }\n    onClose() {\n      this.modalService.dismissAll();\n    }\n  }\n  ApplyPromotionCartComponent.ɵfac = function ApplyPromotionCartComponent_Factory(t) {\n    return new (t || ApplyPromotionCartComponent)(i0.ɵɵdirectiveInject(i1.ToastrService), i0.ɵɵdirectiveInject(i2.NgbModal), i0.ɵɵdirectiveInject(i3.PromotionCodeService), i0.ɵɵdirectiveInject(i4.CartService));\n  };\n  ApplyPromotionCartComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ApplyPromotionCartComponent,\n    selectors: [[\"app-apply-promotion-cart\"]],\n    inputs: {\n      availablePromotions: \"availablePromotions\",\n      amount: \"amount\"\n    },\n    outputs: {\n      applyPromotion: \"applyPromotion\"\n    },\n    decls: 10,\n    vars: 2,\n    consts: [[1, \"modal-content\"], [1, \"modal-header\"], [1, \"modal-title\"], [1, \"close-btn\", 3, \"click\"], [1, \"modal-body\"], [\"class\", \"no-promotion-message\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"modal-footer\"], [1, \"no-promotion-message\"], [\"class\", \"promotion-card\", 4, \"ngFor\", \"ngForOf\"], [1, \"promotion-card\"], [1, \"promotion-header\"], [1, \"promotion-code\"], [1, \"promotion-expiry\"], [1, \"promotion-description\"], [1, \"promotion-row\"], [2, \"color\", \"rgb(241, 18, 18)\", \"padding-top\", \"23px\"], [1, \"promotion-footer\"], [\"class\", \"apply-btn\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"applied-text\", 4, \"ngIf\"], [\"class\", \"error-message\", 4, \"ngIf\"], [1, \"apply-btn\", 3, \"click\"], [1, \"applied-text\"], [1, \"error-message\"]],\n    template: function ApplyPromotionCartComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"h4\", 2);\n        i0.ɵɵtext(3, \"\\u00C1p D\\u1EE5ng M\\u00E3 Gi\\u1EA3m Gi\\u00E1\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function ApplyPromotionCartComponent_Template_button_click_4_listener() {\n          return ctx.onClose();\n        });\n        i0.ɵɵtext(5, \"\\u00D7\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\", 4);\n        i0.ɵɵtemplate(7, ApplyPromotionCartComponent_div_7_Template, 3, 0, \"div\", 5);\n        i0.ɵɵtemplate(8, ApplyPromotionCartComponent_div_8_Template, 2, 1, \"div\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(9, \"div\", 7);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngIf\", ctx.availablePromotions.length === 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.availablePromotions.length > 0);\n      }\n    },\n    directives: [i5.NgIf, i5.NgForOf],\n    pipes: [i6.CurrencyVietnamPipe],\n    styles: [\".modal-header[_ngcontent-%COMP%]{padding:1rem 1rem 1rem 18px;color:#fff;display:flex;justify-content:space-between;align-items:center}.modal-title[_ngcontent-%COMP%]{font-size:2rem;color:#606060;font-weight:500;margin:0}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;color:#fff;cursor:pointer;transition:color .3s ease}.close-btn[_ngcontent-%COMP%]:hover{color:#ff6b6b}.modal-body[_ngcontent-%COMP%]{padding:1.5rem;background-color:#f8f8f8;max-height:400px;overflow-y:auto}.no-promotion-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#606060;text-align:center;margin:1rem 0}.promotion-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:1rem;margin-bottom:1rem;border:1px solid #e0e0e0;box-shadow:0 2px 8px #0000001a;transition:box-shadow .3s ease,transform .3s ease}.promotion-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #00000026;transform:translateY(-2px)}.promotion-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.promotion-code[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#19cda9}.promotion-expiry[_ngcontent-%COMP%]{font-size:1.2rem;color:#888}.promotion-description[_ngcontent-%COMP%]{font-size:1.1rem;color:#606060;margin:.4rem 0 -1rem}.promotion-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;grid-gap:.5rem;gap:.5rem;margin-top:.5rem}.apply-btn[_ngcontent-%COMP%]{background-color:#1bc79c;color:#fff;border:none;padding:.5rem 3.3rem;border-radius:12px;font-size:1.2rem;font-weight:800;cursor:pointer;transition:background-color .3s ease}.apply-btn[_ngcontent-%COMP%]:hover{background-color:#19cda9}.applied-text[_ngcontent-%COMP%]{color:#19cda9;font-weight:700;font-size:.9rem}.error-message[_ngcontent-%COMP%]{font-size:1.2rem;color:#ff6b6b;margin-top:.5rem}.modal-footer[_ngcontent-%COMP%]{padding:2rem;background-color:#f8f8f8;text-align:right}.close-modal-btn[_ngcontent-%COMP%]{background-color:#fff;color:#000;border:1px solid #19cda9;padding:.5rem 1.5rem;border-radius:20px;font-size:.9rem;font-weight:700;cursor:pointer;transition:background-color .3s ease,color .3s ease}.close-modal-btn[_ngcontent-%COMP%]:hover{background-color:#19cda9;color:#fff}.modal-dialog-centered[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.promotion-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:-5px}\"]\n  });\n  return ApplyPromotionCartComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}