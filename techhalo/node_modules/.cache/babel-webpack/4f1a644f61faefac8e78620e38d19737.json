{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"../../services_admin/promotion-code.service\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/common\";\nfunction AddPromotionCodeComponent_Admin_ng_template_0_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 23);\n    i0.ɵɵtext(2, \"S\\u1ED1 l\\u1EA7n s\\u1EED d\\u1EE5ng ph\\u1EA3i l\\u1EDBn h\\u01A1n 0.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddPromotionCodeComponent_Admin_ng_template_0_span_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 24);\n    i0.ɵɵtext(1, \"%\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddPromotionCodeComponent_Admin_ng_template_0_span_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 24);\n    i0.ɵɵtext(1, \"VN\\u0110\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddPromotionCodeComponent_Admin_ng_template_0_div_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 23);\n    i0.ɵɵtext(2, \"Gi\\u1EA3m gi\\u00E1 ph\\u1EA3i n\\u1EB1m trong kho\\u1EA3ng t\\u1EEB 0 \\u0111\\u1EBFn 100%.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddPromotionCodeComponent_Admin_ng_template_0_div_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 23);\n    i0.ɵɵtext(2, \"Gi\\u1EA3m gi\\u00E1 ph\\u1EA3i l\\u1EDBn h\\u01A1n 0 VN\\u0110.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddPromotionCodeComponent_Admin_ng_template_0_div_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 23);\n    i0.ɵɵtext(2, \"Ng\\u00E0y k\\u1EBFt th\\u00FAc ph\\u1EA3i sau ng\\u00E0y b\\u1EAFt \\u0111\\u1EA7u.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddPromotionCodeComponent_Admin_ng_template_0_div_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 23);\n    i0.ɵɵtext(2, \"Gi\\u00E1 tr\\u1ECB t\\u1ED1i thi\\u1EC3u ph\\u1EA3i l\\u1EDBn h\\u01A1n 0.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddPromotionCodeComponent_Admin_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"h2\", 3);\n    i0.ɵɵtext(2, \"Th\\u00EAm m\\u00E3 khuy\\u1EBFn m\\u00E3i m\\u1EDBi\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 4);\n    i0.ɵɵelementStart(4, \"form\", 5);\n    i0.ɵɵelementStart(5, \"div\", 6);\n    i0.ɵɵelementStart(6, \"div\", 7);\n    i0.ɵɵelementStart(7, \"div\", 8);\n    i0.ɵɵelementStart(8, \"label\");\n    i0.ɵɵtext(9, \"M\\u00E3\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"input\", 9);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_10_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.onBlur(\"code\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 8);\n    i0.ɵɵelementStart(12, \"label\");\n    i0.ɵɵtext(13, \"Lo\\u1EA1i\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"select\", 10);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_select_blur_14_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.onBlur(\"type\");\n    });\n    i0.ɵɵelementStart(15, \"option\", 11);\n    i0.ɵɵtext(16, \"Ph\\u1EA7n tr\\u0103m\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"option\", 12);\n    i0.ɵɵtext(18, \"C\\u1ED1 \\u0111\\u1ECBnh\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 8);\n    i0.ɵɵelementStart(20, \"label\");\n    i0.ɵɵtext(21, \"Ng\\u00E0y b\\u1EAFt \\u0111\\u1EA7u\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"input\", 13);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_22_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.onBlur(\"startDate\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 8);\n    i0.ɵɵelementStart(24, \"label\");\n    i0.ɵɵtext(25, \"S\\u1ED1 l\\u1EA7n s\\u1EED d\\u1EE5ng t\\u1ED1i \\u0111a\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"input\", 14);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_26_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.onBlur(\"maxUses\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(27, AddPromotionCodeComponent_Admin_ng_template_0_div_27_Template, 3, 0, \"div\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"div\", 7);\n    i0.ɵɵelementStart(29, \"div\", 8);\n    i0.ɵɵelementStart(30, \"label\");\n    i0.ɵɵtext(31, \"M\\u00F4 t\\u1EA3\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"input\", 16);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_32_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return ctx_r16.onBlur(\"description\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"div\", 8);\n    i0.ɵɵelementStart(34, \"label\");\n    i0.ɵɵtext(35, \"Gi\\u1EA3m gi\\u00E1\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"div\", 17);\n    i0.ɵɵelementStart(37, \"input\", 18);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_37_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return ctx_r17.onBlur(\"discount\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(38, AddPromotionCodeComponent_Admin_ng_template_0_span_38_Template, 2, 0, \"span\", 19);\n    i0.ɵɵtemplate(39, AddPromotionCodeComponent_Admin_ng_template_0_span_39_Template, 2, 0, \"span\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(40, AddPromotionCodeComponent_Admin_ng_template_0_div_40_Template, 3, 0, \"div\", 15);\n    i0.ɵɵtemplate(41, AddPromotionCodeComponent_Admin_ng_template_0_div_41_Template, 3, 0, \"div\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(42, \"div\", 8);\n    i0.ɵɵelementStart(43, \"label\");\n    i0.ɵɵtext(44, \"Ng\\u00E0y k\\u1EBFt th\\u00FAc\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"input\", 20);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_45_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return ctx_r18.onBlur(\"endDate\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(46, AddPromotionCodeComponent_Admin_ng_template_0_div_46_Template, 3, 0, \"div\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(47, \"div\", 8);\n    i0.ɵɵelementStart(48, \"label\");\n    i0.ɵɵtext(49, \"Gi\\u00E1 tr\\u1ECB t\\u1ED1i thi\\u1EC3u\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(50, \"input\", 21);\n    i0.ɵɵlistener(\"blur\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_50_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return ctx_r19.onBlur(\"minOrderValue\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(51, AddPromotionCodeComponent_Admin_ng_template_0_div_51_Template, 3, 0, \"div\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(52, \"div\", 6);\n    i0.ɵɵelementStart(53, \"div\", 22);\n    i0.ɵɵelementStart(54, \"button\", 1);\n    i0.ɵɵlistener(\"click\", function AddPromotionCodeComponent_Admin_ng_template_0_Template_button_click_54_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return ctx_r20.save();\n    });\n    i0.ɵɵtext(55, \"Th\\u00EAm\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    let tmp_1_0;\n    let tmp_2_0;\n    let tmp_3_0;\n    let tmp_4_0;\n    let tmp_5_0;\n    let tmp_6_0;\n    let tmp_7_0;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.postForm);\n    i0.ɵɵadvance(23);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_1_0 = ctx_r1.postForm.get(\"maxUses\")) == null ? null : tmp_1_0.touched) && ((tmp_1_0 = ctx_r1.postForm.get(\"maxUses\")) == null ? null : tmp_1_0.hasError(\"maxUsesInvalid\")));\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_2_0 = ctx_r1.postForm.get(\"type\")) == null ? null : tmp_2_0.value) === \"percentage\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_3_0 = ctx_r1.postForm.get(\"type\")) == null ? null : tmp_3_0.value) === \"fixed\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = ctx_r1.postForm.get(\"discount\")) == null ? null : tmp_4_0.touched) && ((tmp_4_0 = ctx_r1.postForm.get(\"discount\")) == null ? null : tmp_4_0.hasError(\"percentageRange\")));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = ctx_r1.postForm.get(\"discount\")) == null ? null : tmp_5_0.touched) && ((tmp_5_0 = ctx_r1.postForm.get(\"discount\")) == null ? null : tmp_5_0.hasError(\"fixedAmount\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_6_0 = ctx_r1.postForm.get(\"endDate\")) == null ? null : tmp_6_0.touched) && ((tmp_6_0 = ctx_r1.postForm.get(\"endDate\")) == null ? null : tmp_6_0.hasError(\"endDateInvalid\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_7_0 = ctx_r1.postForm.get(\"minOrderValue\")) == null ? null : tmp_7_0.touched) && ((tmp_7_0 = ctx_r1.postForm.get(\"minOrderValue\")) == null ? null : tmp_7_0.hasError(\"minOrderValueInvalid\")));\n  }\n}\n// Validator cho giá trị tối thiểu\nexport function minOrderValueValidator() {\n  return control => {\n    const value = control.value;\n    if (value <= 0) {\n      return {\n        'minOrderValueInvalid': 'Giá trị tối thiểu phải lớn hơn 0'\n      }; // Lỗi nếu giá trị nhỏ hơn hoặc bằng 0\n    }\n    return null; // Không có lỗi nếu giá trị hợp lệ\n  };\n}\nexport function discountValidator() {\n  return control => {\n    var _a, _b;\n    const type = (_b = (_a = control.root) === null || _a === void 0 ? void 0 : _a.get('type')) === null || _b === void 0 ? void 0 : _b.value; // Lấy giá trị của 'type'\n    const discount = control.value;\n    if (type === 'percentage') {\n      if (discount < 0 || discount > 100) {\n        return {\n          'percentageRange': 'Giảm giá phải nằm trong khoảng từ 0 đến 100%'\n        };\n      }\n    } else if (type === 'fixed') {\n      if (discount <= 0) {\n        return {\n          'fixedAmount': 'Giảm giá phải lớn hơn 0 VNĐ'\n        };\n      }\n    }\n    return null;\n  };\n}\n// Validator cho maxUses, kiểm tra số lần sử dụng phải lớn hơn 0\nexport function maxUsesValidator() {\n  return control => {\n    const value = control.value;\n    if (value <= 0) {\n      return {\n        'maxUsesInvalid': 'Số lần sử dụng phải lớn hơn 0'\n      };\n    }\n    return null;\n  };\n}\n// Validator cho ngày kết thúc, phải sau ngày bắt đầu\nexport function endDateValidator() {\n  return control => {\n    var _a, _b;\n    const startDate = (_b = (_a = control.root) === null || _a === void 0 ? void 0 : _a.get('startDate')) === null || _b === void 0 ? void 0 : _b.value;\n    const endDate = control.value;\n    if (startDate && endDate && new Date(endDate) <= new Date(startDate)) {\n      return {\n        'endDateInvalid': 'Ngày kết thúc phải sau ngày bắt đầu'\n      };\n    }\n    return null;\n  };\n}\nexport let AddPromotionCodeComponent_Admin = /*#__PURE__*/(() => {\n  class AddPromotionCodeComponent_Admin {\n    constructor(modalService, promotionCodeService, toastr) {\n      this.modalService = modalService;\n      this.promotionCodeService = promotionCodeService;\n      this.toastr = toastr;\n      this.saveFinish = new EventEmitter();\n      this.postForm = new FormGroup({\n        code: new FormControl('', [Validators.required]),\n        description: new FormControl('', [Validators.required]),\n        type: new FormControl('percentage', [Validators.required]),\n        discount: new FormControl('', [Validators.required, Validators.min(0), discountValidator()]),\n        startDate: new FormControl(new Date(), [Validators.required]),\n        endDate: new FormControl(new Date(), [Validators.required, endDateValidator()]),\n        minOrderValue: new FormControl('', [Validators.required, minOrderValueValidator()]),\n        maxUses: new FormControl('', [Validators.required, maxUsesValidator()]),\n        isActive: new FormControl(true)\n      });\n    }\n    open(content) {\n      this.modalService.open(content, {\n        centered: true,\n        size: 'lg'\n      });\n    }\n    // Khi người dùng rời khỏi trường input, gọi markAsTouched\n    onBlur(controlName) {\n      const control = this.postForm.get(controlName);\n      if (control) {\n        control.markAsTouched();\n      }\n    }\n    save() {\n      if (this.postForm.valid) {\n        this.promotionCodeService.create(this.postForm.value).subscribe(() => {\n          this.toastr.success('Thêm mã khuyến mãi thành công!', 'Hệ thống');\n          this.modalService.dismissAll();\n          this.saveFinish.emit();\n        }, () => {\n          this.toastr.error('Thêm mã khuyến mãi thất bại!', 'Hệ thống');\n        });\n      }\n    }\n  }\n  AddPromotionCodeComponent_Admin.ɵfac = function AddPromotionCodeComponent_Admin_Factory(t) {\n    return new (t || AddPromotionCodeComponent_Admin)(i0.ɵɵdirectiveInject(i1.NgbModal), i0.ɵɵdirectiveInject(i2.PromotionCodeService), i0.ɵɵdirectiveInject(i3.ToastrService));\n  };\n  AddPromotionCodeComponent_Admin.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddPromotionCodeComponent_Admin,\n    selectors: [[\"app-add-promotion-code\"]],\n    outputs: {\n      saveFinish: \"saveFinish\"\n    },\n    decls: 4,\n    vars: 0,\n    consts: [[\"content\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"modal-header\"], [1, \"modal-title\"], [1, \"modal-body\"], [3, \"formGroup\"], [1, \"row\"], [1, \"col-md-6\"], [1, \"form-group\"], [\"type\", \"text\", \"formControlName\", \"code\", 1, \"form-control\", 3, \"blur\"], [\"formControlName\", \"type\", 1, \"form-control\", 3, \"blur\"], [\"value\", \"percentage\"], [\"value\", \"fixed\"], [\"type\", \"date\", \"formControlName\", \"startDate\", 1, \"form-control\", 3, \"blur\"], [\"type\", \"number\", \"formControlName\", \"maxUses\", 1, \"form-control\", 3, \"blur\"], [4, \"ngIf\"], [\"type\", \"text\", \"formControlName\", \"description\", 1, \"form-control\", 3, \"blur\"], [1, \"input-group\"], [\"type\", \"number\", \"formControlName\", \"discount\", 1, \"form-control\", 3, \"blur\"], [\"class\", \"input-group-text\", 4, \"ngIf\"], [\"type\", \"date\", \"formControlName\", \"endDate\", 1, \"form-control\", 3, \"blur\"], [\"type\", \"number\", \"formControlName\", \"minOrderValue\", 1, \"form-control\", 3, \"blur\"], [1, \"col-md-12\", \"d-flex\", \"justify-content-end\", \"align-items-end\"], [1, \"text-danger\"], [1, \"input-group-text\"]],\n    template: function AddPromotionCodeComponent_Admin_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r21 = i0.ɵɵgetCurrentView();\n        i0.ɵɵtemplate(0, AddPromotionCodeComponent_Admin_ng_template_0_Template, 56, 8, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementStart(2, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AddPromotionCodeComponent_Admin_Template_button_click_2_listener() {\n          i0.ɵɵrestoreView(_r21);\n          const _r0 = i0.ɵɵreference(1);\n          return ctx.open(_r0);\n        });\n        i0.ɵɵtext(3, \"Th\\u00EAm m\\u00E3 khuy\\u1EBFn m\\u00E3i\");\n        i0.ɵɵelementEnd();\n      }\n    },\n    directives: [i4.MatButton, i5.ɵNgNoValidate, i5.NgControlStatusGroup, i5.FormGroupDirective, i5.DefaultValueAccessor, i5.NgControlStatus, i5.FormControlName, i5.SelectControlValueAccessor, i5.NgSelectOption, i5.ɵNgSelectMultipleOption, i5.NumberValueAccessor, i6.NgIf],\n    styles: [\"\"]\n  });\n  return AddPromotionCodeComponent_Admin;\n})();","map":null,"metadata":{},"sourceType":"module"}