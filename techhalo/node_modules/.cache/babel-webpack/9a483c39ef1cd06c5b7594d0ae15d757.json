{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"../../services_admin/promotion-code.service\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/button\";\nfunction EditPromotionCodeComponent_Admin_ng_template_0_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 34);\n    i0.ɵɵtext(2, \"S\\u1ED1 l\\u1EA7n s\\u1EED d\\u1EE5ng ph\\u1EA3i l\\u1EDBn h\\u01A1n 0.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditPromotionCodeComponent_Admin_ng_template_0_span_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 35);\n    i0.ɵɵtext(1, \"%\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditPromotionCodeComponent_Admin_ng_template_0_span_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 35);\n    i0.ɵɵtext(1, \"VN\\u0110\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditPromotionCodeComponent_Admin_ng_template_0_div_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 34);\n    i0.ɵɵtext(2, \"Gi\\u1EA3m gi\\u00E1 ph\\u1EA3i n\\u1EB1m trong kho\\u1EA3ng t\\u1EEB 0 \\u0111\\u1EBFn 100%.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditPromotionCodeComponent_Admin_ng_template_0_div_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 34);\n    i0.ɵɵtext(2, \"Gi\\u1EA3m gi\\u00E1 ph\\u1EA3i l\\u1EDBn h\\u01A1n 0 VN\\u0110.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditPromotionCodeComponent_Admin_ng_template_0_div_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 34);\n    i0.ɵɵtext(2, \"Ng\\u00E0y k\\u1EBFt th\\u00FAc ph\\u1EA3i sau ng\\u00E0y b\\u1EAFt \\u0111\\u1EA7u.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditPromotionCodeComponent_Admin_ng_template_0_div_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"small\", 34);\n    i0.ɵɵtext(2, \"Gi\\u00E1 tr\\u1ECB t\\u1ED1i thi\\u1EC3u ph\\u1EA3i l\\u1EDBn h\\u01A1n 0.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditPromotionCodeComponent_Admin_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵelementStart(1, \"h2\", 4);\n    i0.ɵɵtext(2, \"Ch\\u1EC9nh s\\u1EEDa m\\u00E3 khuy\\u1EBFn m\\u00E3i\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 5);\n    i0.ɵɵelementStart(4, \"form\", 6);\n    i0.ɵɵelementStart(5, \"div\", 7);\n    i0.ɵɵelementStart(6, \"div\", 8);\n    i0.ɵɵelementStart(7, \"div\", 9);\n    i0.ɵɵelementStart(8, \"label\", 10);\n    i0.ɵɵtext(9, \"M\\u00E3\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(10, \"input\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 9);\n    i0.ɵɵelementStart(12, \"label\", 12);\n    i0.ɵɵtext(13, \"Lo\\u1EA1i\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"select\", 13);\n    i0.ɵɵlistener(\"blur\", function EditPromotionCodeComponent_Admin_ng_template_0_Template_select_blur_14_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.onBlur(\"type\");\n    });\n    i0.ɵɵelementStart(15, \"option\", 14);\n    i0.ɵɵtext(16, \"Ph\\u1EA7n tr\\u0103m\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"option\", 15);\n    i0.ɵɵtext(18, \"C\\u1ED1 \\u0111\\u1ECBnh\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 9);\n    i0.ɵɵelementStart(20, \"label\", 16);\n    i0.ɵɵtext(21, \"Ng\\u00E0y b\\u1EAFt \\u0111\\u1EA7u\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(22, \"input\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 18);\n    i0.ɵɵelementStart(24, \"label\");\n    i0.ɵɵtext(25, \"S\\u1ED1 l\\u1EA7n s\\u1EED d\\u1EE5ng t\\u1ED1i \\u0111a\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"input\", 19);\n    i0.ɵɵlistener(\"blur\", function EditPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_26_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.onBlur(\"maxUses\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(27, EditPromotionCodeComponent_Admin_ng_template_0_div_27_Template, 3, 0, \"div\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"div\", 8);\n    i0.ɵɵelementStart(29, \"div\", 9);\n    i0.ɵɵelementStart(30, \"label\", 21);\n    i0.ɵɵtext(31, \"M\\u00F4 t\\u1EA3\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(32, \"input\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"div\", 9);\n    i0.ɵɵelementStart(34, \"label\", 23);\n    i0.ɵɵtext(35, \"Gi\\u1EA3m gi\\u00E1\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"div\", 24);\n    i0.ɵɵelementStart(37, \"input\", 25);\n    i0.ɵɵlistener(\"blur\", function EditPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_37_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.onBlur(\"discount\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(38, EditPromotionCodeComponent_Admin_ng_template_0_span_38_Template, 2, 0, \"span\", 26);\n    i0.ɵɵtemplate(39, EditPromotionCodeComponent_Admin_ng_template_0_span_39_Template, 2, 0, \"span\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(40, EditPromotionCodeComponent_Admin_ng_template_0_div_40_Template, 3, 0, \"div\", 20);\n    i0.ɵɵtemplate(41, EditPromotionCodeComponent_Admin_ng_template_0_div_41_Template, 3, 0, \"div\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(42, \"div\", 9);\n    i0.ɵɵelementStart(43, \"label\", 27);\n    i0.ɵɵtext(44, \"Ng\\u00E0y k\\u1EBFt th\\u00FAc\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"input\", 28);\n    i0.ɵɵlistener(\"blur\", function EditPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_45_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.onBlur(\"endDate\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(46, EditPromotionCodeComponent_Admin_ng_template_0_div_46_Template, 3, 0, \"div\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(47, \"div\", 9);\n    i0.ɵɵelementStart(48, \"label\", 29);\n    i0.ɵɵtext(49, \"Gi\\u00E1 tr\\u1ECB t\\u1ED1i thi\\u1EC3u\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(50, \"input\", 30);\n    i0.ɵɵlistener(\"blur\", function EditPromotionCodeComponent_Admin_ng_template_0_Template_input_blur_50_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return ctx_r16.onBlur(\"minOrderValue\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(51, EditPromotionCodeComponent_Admin_ng_template_0_div_51_Template, 3, 0, \"div\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(52, \"div\", 31);\n    i0.ɵɵelementStart(53, \"div\", 32);\n    i0.ɵɵelementStart(54, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function EditPromotionCodeComponent_Admin_ng_template_0_Template_button_click_54_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return ctx_r17.update();\n    });\n    i0.ɵɵtext(55, \"C\\u1EADp nh\\u1EADt\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    let tmp_1_0;\n    let tmp_2_0;\n    let tmp_3_0;\n    let tmp_4_0;\n    let tmp_5_0;\n    let tmp_6_0;\n    let tmp_7_0;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.promotionCodeForm);\n    i0.ɵɵadvance(23);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_1_0 = ctx_r1.promotionCodeForm.get(\"maxUses\")) == null ? null : tmp_1_0.touched) && ((tmp_1_0 = ctx_r1.promotionCodeForm.get(\"maxUses\")) == null ? null : tmp_1_0.hasError(\"maxUsesInvalid\")));\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_2_0 = ctx_r1.promotionCodeForm.get(\"type\")) == null ? null : tmp_2_0.value) === \"percentage\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_3_0 = ctx_r1.promotionCodeForm.get(\"type\")) == null ? null : tmp_3_0.value) === \"fixed\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = ctx_r1.promotionCodeForm.get(\"discount\")) == null ? null : tmp_4_0.touched) && ((tmp_4_0 = ctx_r1.promotionCodeForm.get(\"discount\")) == null ? null : tmp_4_0.hasError(\"percentageRange\")));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = ctx_r1.promotionCodeForm.get(\"discount\")) == null ? null : tmp_5_0.touched) && ((tmp_5_0 = ctx_r1.promotionCodeForm.get(\"discount\")) == null ? null : tmp_5_0.hasError(\"fixedAmount\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_6_0 = ctx_r1.promotionCodeForm.get(\"endDate\")) == null ? null : tmp_6_0.touched) && ((tmp_6_0 = ctx_r1.promotionCodeForm.get(\"endDate\")) == null ? null : tmp_6_0.hasError(\"endDateInvalid\")));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_7_0 = ctx_r1.promotionCodeForm.get(\"minOrderValue\")) == null ? null : tmp_7_0.touched) && ((tmp_7_0 = ctx_r1.promotionCodeForm.get(\"minOrderValue\")) == null ? null : tmp_7_0.hasError(\"minOrderValueInvalid\")));\n  }\n}\n// Validator cho giá trị tối thiểu\nexport function minOrderValueValidator() {\n  return control => {\n    const value = control.value;\n    if (value <= 0) {\n      return {\n        'minOrderValueInvalid': 'Giá trị tối thiểu phải lớn hơn 0'\n      }; // Lỗi nếu giá trị nhỏ hơn hoặc bằng 0\n    }\n    return null; // Không có lỗi nếu giá trị hợp lệ\n  };\n}\nexport function discountValidator() {\n  return control => {\n    var _a, _b;\n    const type = (_b = (_a = control.root) === null || _a === void 0 ? void 0 : _a.get('type')) === null || _b === void 0 ? void 0 : _b.value; // Lấy giá trị của 'type'\n    const discount = control.value;\n    if (type === 'percentage') {\n      if (discount < 0 || discount > 100) {\n        return {\n          'percentageRange': 'Giảm giá phải nằm trong khoảng từ 0 đến 100%'\n        };\n      }\n    } else if (type === 'fixed') {\n      if (discount <= 0) {\n        return {\n          'fixedAmount': 'Giảm giá phải lớn hơn 0 VNĐ'\n        };\n      }\n    }\n    return null;\n  };\n}\n// Validator cho maxUses, kiểm tra số lần sử dụng phải lớn hơn 0\nexport function maxUsesValidator() {\n  return control => {\n    const value = control.value;\n    if (value <= 0) {\n      return {\n        'maxUsesInvalid': 'Số lần sử dụng phải lớn hơn 0'\n      };\n    }\n    return null;\n  };\n}\n// Validator cho ngày kết thúc, phải sau ngày bắt đầu\nexport function endDateValidator() {\n  return control => {\n    var _a, _b;\n    const startDate = (_b = (_a = control.root) === null || _a === void 0 ? void 0 : _a.get('startDate')) === null || _b === void 0 ? void 0 : _b.value;\n    const endDate = control.value;\n    if (startDate && endDate && new Date(endDate) <= new Date(startDate)) {\n      return {\n        'endDateInvalid': 'Ngày kết thúc phải sau ngày bắt đầu'\n      };\n    }\n    return null;\n  };\n}\nexport let EditPromotionCodeComponent_Admin = /*#__PURE__*/(() => {\n  class EditPromotionCodeComponent_Admin {\n    constructor(modalService, promotionCodeService, toastr) {\n      this.modalService = modalService;\n      this.promotionCodeService = promotionCodeService;\n      this.toastr = toastr;\n      this.editFinish = new EventEmitter();\n      this.promotionCodeForm = new FormGroup({\n        code: new FormControl('', [Validators.required]),\n        description: new FormControl('', [Validators.required]),\n        type: new FormControl('', [Validators.required]),\n        discount: new FormControl('', [Validators.required, Validators.min(0), discountValidator()]),\n        startDate: new FormControl(new Date(), [Validators.required]),\n        endDate: new FormControl(new Date(), [Validators.required, endDateValidator()]),\n        minOrderValue: new FormControl('', [Validators.required, minOrderValueValidator()]),\n        maxUses: new FormControl('', [Validators.required, maxUsesValidator()]),\n        isActive: new FormControl(true)\n      });\n    }\n    ngOnInit() {\n      this.loadPromotionCode();\n    }\n    loadPromotionCode() {\n      this.promotionCodeService.getOne(this.id).subscribe(data => {\n        this.promotionCode = data;\n        this.promotionCodeForm.patchValue(this.promotionCode);\n      });\n    }\n    // Khi người dùng rời khỏi trường input, gọi markAsTouched\n    onBlur(controlName) {\n      const control = this.promotionCodeForm.get(controlName);\n      if (control) {\n        control.markAsTouched();\n      }\n    }\n    update() {\n      if (this.promotionCodeForm.valid) {\n        this.promotionCodeService.update(this.id, this.promotionCodeForm.value).subscribe(() => {\n          this.toastr.success('Cập nhật mã khuyến mãi thành công!', 'Hệ thống');\n          this.modalService.dismissAll();\n          this.editFinish.emit();\n        }, () => {\n          this.toastr.error('Cập nhật thất bại!', 'Hệ thống');\n        });\n      }\n    }\n    open(content) {\n      this.modalService.open(content, {\n        centered: true,\n        size: 'lg'\n      });\n    }\n  }\n  EditPromotionCodeComponent_Admin.ɵfac = function EditPromotionCodeComponent_Admin_Factory(t) {\n    return new (t || EditPromotionCodeComponent_Admin)(i0.ɵɵdirectiveInject(i1.NgbModal), i0.ɵɵdirectiveInject(i2.PromotionCodeService), i0.ɵɵdirectiveInject(i3.ToastrService));\n  };\n  EditPromotionCodeComponent_Admin.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EditPromotionCodeComponent_Admin,\n    selectors: [[\"app-edit-promotion-code\"]],\n    inputs: {\n      id: \"id\"\n    },\n    outputs: {\n      editFinish: \"editFinish\"\n    },\n    decls: 4,\n    vars: 0,\n    consts: [[\"content\", \"\"], [2, \"color\", \"steelblue\", \"cursor\", \"pointer\", 3, \"click\"], [1, \"fas\", \"fa-edit\"], [1, \"modal-header\"], [1, \"modal-title\"], [1, \"modal-body\"], [3, \"formGroup\"], [1, \"row\"], [1, \"col-md-6\"], [1, \"form-group\", \"mb-3\"], [\"for\", \"code\"], [\"type\", \"text\", \"id\", \"code\", \"formControlName\", \"code\", 1, \"form-control\"], [\"for\", \"type\"], [\"id\", \"type\", \"formControlName\", \"type\", 1, \"form-control\", 3, \"blur\"], [\"value\", \"percentage\"], [\"value\", \"fixed\"], [\"for\", \"startDate\"], [\"type\", \"date\", \"id\", \"startDate\", \"formControlName\", \"startDate\", 1, \"form-control\"], [1, \"form-group\"], [\"type\", \"number\", \"formControlName\", \"maxUses\", 1, \"form-control\", 3, \"blur\"], [4, \"ngIf\"], [\"for\", \"description\"], [\"type\", \"text\", \"id\", \"description\", \"formControlName\", \"description\", 1, \"form-control\"], [\"for\", \"discount\"], [1, \"input-group\"], [\"type\", \"number\", \"formControlName\", \"discount\", 1, \"form-control\", 3, \"blur\"], [\"class\", \"input-group-text\", 4, \"ngIf\"], [\"for\", \"endDate\"], [\"type\", \"date\", \"formControlName\", \"endDate\", 1, \"form-control\", 3, \"blur\"], [\"for\", \"minOrderValue\"], [\"type\", \"number\", \"formControlName\", \"minOrderValue\", 1, \"form-control\", 3, \"blur\"], [1, \"row\", \"mt-3\"], [1, \"col-12\", \"d-flex\", \"justify-content-end\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"text-danger\"], [1, \"input-group-text\"]],\n    template: function EditPromotionCodeComponent_Admin_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r18 = i0.ɵɵgetCurrentView();\n        i0.ɵɵtemplate(0, EditPromotionCodeComponent_Admin_ng_template_0_Template, 56, 8, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementStart(2, \"a\", 1);\n        i0.ɵɵlistener(\"click\", function EditPromotionCodeComponent_Admin_Template_a_click_2_listener() {\n          i0.ɵɵrestoreView(_r18);\n          const _r0 = i0.ɵɵreference(1);\n          return ctx.open(_r0);\n        });\n        i0.ɵɵelement(3, \"i\", 2);\n        i0.ɵɵelementEnd();\n      }\n    },\n    directives: [i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.DefaultValueAccessor, i4.NgControlStatus, i4.FormControlName, i4.SelectControlValueAccessor, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.NumberValueAccessor, i5.NgIf, i6.MatButton],\n    styles: [\"\"]\n  });\n  return EditPromotionCodeComponent_Admin;\n})();","map":null,"metadata":{},"sourceType":"module"}