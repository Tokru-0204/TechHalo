{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"src/app/services_admin/purchase-order-detail.service\";\nimport * as i3 from \"src/app/services_admin/supplier.service\";\nimport * as i4 from \"src/app/services_admin/product.service\";\nimport * as i5 from \"src/app/services_admin/purchase-order.service\";\nimport * as i6 from \"ngx-toastr\";\nimport * as i7 from \"@angular/material/button\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"@angular/common\";\nfunction AddPurchaseOrderComponent_Admin_ng_template_0_option_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const supplier_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", supplier_r6.supplierId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", supplier_r6.name, \" \");\n  }\n}\nfunction AddPurchaseOrderComponent_Admin_ng_template_0_div_10_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const product_r8 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", product_r8.productId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", product_r8.name, \" \");\n  }\n}\nfunction AddPurchaseOrderComponent_Admin_ng_template_0_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6);\n    i0.ɵɵelementStart(1, \"label\", 23);\n    i0.ɵɵtext(2, \"S\\u1EA3n ph\\u1EA9m:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 24);\n    i0.ɵɵelementStart(4, \"option\", 25);\n    i0.ɵɵtext(5, \"Ch\\u1ECDn s\\u1EA3n ph\\u1EA9m\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, AddPurchaseOrderComponent_Admin_ng_template_0_div_10_option_6_Template, 2, 2, \"option\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.products);\n  }\n}\nfunction AddPurchaseOrderComponent_Admin_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"h2\", 3);\n    i0.ɵɵtext(2, \"Nh\\u1EADp h\\u00E0ng\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 4);\n    i0.ɵɵelementStart(4, \"form\", 5);\n    i0.ɵɵelementStart(5, \"div\", 6);\n    i0.ɵɵelementStart(6, \"label\", 7);\n    i0.ɵɵtext(7, \"Nh\\u00E0 cung c\\u1EA5p:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"select\", 8);\n    i0.ɵɵlistener(\"change\", function AddPurchaseOrderComponent_Admin_ng_template_0_Template_select_change_8_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.onSupplierChange($event);\n    });\n    i0.ɵɵtemplate(9, AddPurchaseOrderComponent_Admin_ng_template_0_option_9_Template, 2, 2, \"option\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, AddPurchaseOrderComponent_Admin_ng_template_0_div_10_Template, 7, 1, \"div\", 10);\n    i0.ɵɵelementStart(11, \"div\", 6);\n    i0.ɵɵelementStart(12, \"label\", 11);\n    i0.ɵɵtext(13, \"S\\u1ED1 l\\u01B0\\u1EE3ng:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"input\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 6);\n    i0.ɵɵelementStart(16, \"label\", 13);\n    i0.ɵɵtext(17, \"\\u0110\\u01A1n gi\\u00E1:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"input\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 6);\n    i0.ɵɵelementStart(20, \"label\", 15);\n    i0.ɵɵtext(21, \"T\\u1ED5ng ti\\u1EC1n:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(22, \"input\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 6);\n    i0.ɵɵelementStart(24, \"label\", 17);\n    i0.ɵɵtext(25, \"Ng\\u00E0y t\\u1EA1o:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(26, \"input\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"div\", 6);\n    i0.ɵɵelementStart(28, \"label\", 19);\n    i0.ɵɵtext(29, \"Ng\\u00E0y c\\u1EADp nh\\u1EADt:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(30, \"input\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function AddPurchaseOrderComponent_Admin_ng_template_0_Template_button_click_31_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.save();\n    });\n    i0.ɵɵtext(32, \"Th\\u00EAm\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.postForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.suppliers);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.products.length > 0);\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"value\", ctx_r1.calculateTotal());\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.postForm == null ? null : ctx_r1.postForm.invalid);\n  }\n}\nexport let AddPurchaseOrderComponent_Admin = /*#__PURE__*/(() => {\n  class AddPurchaseOrderComponent_Admin {\n    constructor(modalService, purchaseOrderDetailsService, supplierService, productService, purchaseOrderService, toastr) {\n      this.modalService = modalService;\n      this.purchaseOrderDetailsService = purchaseOrderDetailsService;\n      this.supplierService = supplierService;\n      this.productService = productService;\n      this.purchaseOrderService = purchaseOrderService;\n      this.toastr = toastr;\n      this.totalAmount = 0; // Tổng số tiền\n      this.selectedSupplierId = 0; // ID nhà cung cấp được chọn\n      this.saveFinish = new EventEmitter();\n    }\n    ngOnInit() {\n      this.initializeForm();\n      this.loadSuppliers();\n      this.getPurchaseOrders();\n      this.getProductBySupplier(this.selectedSupplierId);\n    }\n    initializeForm() {\n      this.postForm = new FormGroup({\n        'supplierId': new FormControl(0),\n        'purchaseOrderId': new FormControl(0),\n        'productId': new FormControl(0),\n        'quantity': new FormControl(null, [Validators.required, Validators.min(1)]),\n        'price': new FormControl(null, [Validators.required, Validators.min(1000)]),\n        'totalMoney': new FormControl({\n          value: 0,\n          disabled: true\n        }),\n        'create_at': new FormControl(new Date().toISOString().split('T')[0], [Validators.required]),\n        'update_at': new FormControl(new Date().toISOString().split('T')[0]) // Ngày cập nhật\n      });\n    }\n    loadSuppliers() {\n      this.supplierService.getAllSup().subscribe(suppliers => {\n        this.suppliers = suppliers;\n      }, error => {\n        this.toastr.error('Lỗi khi tải nhà cung cấp!', 'Hệ thống');\n        console.error(error);\n      });\n    }\n    getPurchaseOrders() {\n      this.purchaseOrderService.getAllPurchaseOrders().subscribe(purchaseOrders => {\n        this.purchaseOrders = purchaseOrders;\n      }, error => {\n        this.toastr.error('Lỗi khi tải đơn hàng nhập!', 'Hệ thống');\n        console.error(error);\n      });\n    }\n    save() {\n      if (this.postForm.invalid) {\n        this.toastr.warning('Vui lòng điền đầy đủ thông tin!', 'Hệ thống');\n        return;\n      }\n      const {\n        productId,\n        supplierId,\n        quantity,\n        price\n      } = this.postForm.value;\n      console.log(this.postForm.value);\n      // Gọi service để tạo chi tiết đơn hàng\n      this.purchaseOrderDetailsService.create(productId, supplierId, quantity, price).subscribe(() => {\n        this.toastr.success('Thêm chi tiết đơn hàng thành công!', 'Hệ thống');\n        this.saveFinish.emit();\n        this.products = [];\n        this.resetForm();\n      }, error => {\n        this.toastr.error('Lỗi khi thêm chi tiết đơn hàng!', 'Hệ thống');\n        console.error(error);\n      });\n    }\n    resetForm() {\n      this.postForm.reset({\n        'purchaseOrderId': 0,\n        'productId': 0,\n        'supplierId': 0,\n        'quantity': null,\n        'price': null,\n        'totalMoney': 0,\n        'create_at': new Date().toISOString().split('T')[0],\n        'update_at': new Date().toISOString().split('T')[0]\n      });\n    }\n    // find product by supplier\n    getProductBySupplier(supplierId) {\n      this.productService.getProductsByCompany(supplierId).subscribe(data => {\n        this.products = data;\n      }, error => {\n        this.toastr.error('Lỗi khi tải sản phẩm!', 'Hệ thống');\n        console.error(error);\n      });\n      console.log(\"dfdfdf\", this.products);\n    }\n    onSupplierChange(event) {\n      const selectedSupplierId = event.target.value;\n      this.selectedSupplierId = Number(selectedSupplierId);\n      if (selectedSupplierId) {\n        this.getProductBySupplier(Number(selectedSupplierId));\n      }\n    }\n    //   getProducts() {\n    //     this.productService.getAllProducts().subscribe(data => {\n    //       this.products = data as Product[];\n    //     }, error => {\n    //       this.toastr.error('Lỗi khi tải sản phẩm!', 'Hệ thống');\n    //       console.error(error);\n    //   })\n    // }\n    calculateTotal() {\n      var _a, _b;\n      const quantity = ((_a = this.postForm.get('quantity')) === null || _a === void 0 ? void 0 : _a.value) || 0;\n      const price = ((_b = this.postForm.get('price')) === null || _b === void 0 ? void 0 : _b.value) || 0;\n      return quantity * price;\n    }\n    open(content) {\n      this.modalService.open(content, {\n        centered: true\n      });\n    }\n    closeModal() {\n      this.modalService.dismissAll();\n      this.resetForm();\n    }\n  }\n  AddPurchaseOrderComponent_Admin.ɵfac = function AddPurchaseOrderComponent_Admin_Factory(t) {\n    return new (t || AddPurchaseOrderComponent_Admin)(i0.ɵɵdirectiveInject(i1.NgbModal), i0.ɵɵdirectiveInject(i2.PurchaseOrderDetailsService), i0.ɵɵdirectiveInject(i3.SupplierService), i0.ɵɵdirectiveInject(i4.ProductService), i0.ɵɵdirectiveInject(i5.PurchaseOrderService), i0.ɵɵdirectiveInject(i6.ToastrService));\n  };\n  AddPurchaseOrderComponent_Admin.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddPurchaseOrderComponent_Admin,\n    selectors: [[\"app-add-purchase-order\"]],\n    outputs: {\n      saveFinish: \"saveFinish\"\n    },\n    decls: 4,\n    vars: 0,\n    consts: [[\"content\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"modal-header\"], [1, \"modal-title\", \"m-0\"], [1, \"modal-body\", \"p-4\"], [3, \"formGroup\"], [1, \"form-group\", \"mb-3\"], [\"for\", \"supplier\", 1, \"form-label\"], [\"id\", \"supplier\", \"formControlName\", \"supplierId\", \"required\", \"\", 1, \"form-control\", 3, \"change\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"form-group mb-3\", 4, \"ngIf\"], [\"for\", \"quantity\", 1, \"form-label\"], [\"type\", \"number\", \"id\", \"quantity\", \"formControlName\", \"quantity\", \"min\", \"1\", \"placeholder\", \"Nh\\u1EADp s\\u1ED1 l\\u01B0\\u1EE3ng\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"price\", 1, \"form-label\"], [\"type\", \"number\", \"id\", \"price\", \"formControlName\", \"price\", \"min\", \"1\", \"placeholder\", \"Nh\\u1EADp \\u0111\\u01A1n gi\\u00E1\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"totalMoney\", 1, \"form-label\"], [\"type\", \"number\", \"id\", \"totalMoney\", \"readonly\", \"\", 1, \"form-control\", 3, \"value\"], [\"for\", \"create_at\", 1, \"form-label\"], [\"type\", \"date\", \"id\", \"create_at\", \"formControlName\", \"create_at\", \"readonly\", \"\", 1, \"form-control\"], [\"for\", \"update_at\", 1, \"form-label\"], [\"type\", \"date\", \"id\", \"update_at\", \"formControlName\", \"update_at\", \"readonly\", \"\", 1, \"form-control\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"disabled\", \"click\"], [3, \"value\"], [\"for\", \"product\", 1, \"form-label\"], [\"id\", \"product\", \"formControlName\", \"productId\", \"required\", \"\", 1, \"form-control\"], [\"value\", \"0\", \"disabled\", \"\", \"selected\", \"\"]],\n    template: function AddPurchaseOrderComponent_Admin_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r12 = i0.ɵɵgetCurrentView();\n        i0.ɵɵtemplate(0, AddPurchaseOrderComponent_Admin_ng_template_0_Template, 33, 5, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementStart(2, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AddPurchaseOrderComponent_Admin_Template_button_click_2_listener() {\n          i0.ɵɵrestoreView(_r12);\n          const _r0 = i0.ɵɵreference(1);\n          return ctx.open(_r0);\n        });\n        i0.ɵɵtext(3, \"Nh\\u1EADp h\\u00E0ng\");\n        i0.ɵɵelementEnd();\n      }\n    },\n    directives: [i7.MatButton, i8.ɵNgNoValidate, i8.NgControlStatusGroup, i8.FormGroupDirective, i8.SelectControlValueAccessor, i8.NgControlStatus, i8.FormControlName, i8.RequiredValidator, i9.NgForOf, i9.NgIf, i8.NumberValueAccessor, i8.MinValidator, i8.DefaultValueAccessor, i8.NgSelectOption, i8.ɵNgSelectMultipleOption],\n    styles: [\"\"]\n  });\n  return AddPurchaseOrderComponent_Admin;\n})();","map":null,"metadata":{},"sourceType":"module"}