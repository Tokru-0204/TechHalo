{"ast":null,"code":"import { Chart, registerables } from 'chart.js';\nimport ChartDataLabels from 'chartjs-plugin-datalabels';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services_admin/page.service\";\nimport * as i2 from \"ngx-toastr\";\nimport * as i3 from \"../../services_admin/order.service\";\nimport * as i4 from \"../../services_admin/customer.service\";\nimport * as i5 from \"../../services_admin/statistical.service\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../../pipes/currency-vietnam.pipe\";\nfunction DashboardComponent_Admin_li_57_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵelementStart(1, \"a\", 34);\n    i0.ɵɵlistener(\"click\", function DashboardComponent_Admin_li_57_Template_a_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r3);\n      const y_r1 = restoredCtx.$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.selectYear(y_r1);\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const y_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassProp(\"active\", y_r1 === ctx_r0.year);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", y_r1, \" \");\n  }\n}\nconst _c0 = function () {\n  return [\"/admin/customer\"];\n};\nconst _c1 = function () {\n  return [\"/admin/order\"];\n};\nChart.register(ChartDataLabels);\nexport let DashboardComponent_Admin = /*#__PURE__*/(() => {\n  class DashboardComponent_Admin {\n    constructor(pageService, toastr, orderService, customerService, statisticalService) {\n      this.pageService = pageService;\n      this.toastr = toastr;\n      this.orderService = orderService;\n      this.customerService = customerService;\n      this.statisticalService = statisticalService;\n      this.year = new Date().getFullYear();\n      this.month = new Date().getMonth() + 1;\n      this.day = new Date().getDate();\n      this.countYears = [];\n      this.labels = [];\n      this.data = [];\n      this.chatMessages = [];\n    }\n    ngOnInit() {\n      this.openWebSocket();\n      this.pageService.setPageActive('dashboard');\n      this.getAllOrder();\n      this.getAllCustomer();\n      Chart.register(...registerables);\n      Chart.register(...registerables);\n      this.loadDefaultRevenue();\n      this.loadYears();\n      this.updateChart('year');\n    }\n    ngOnDestroy() {\n      this.closeWebSocket();\n    }\n    loadDefaultRevenue() {\n      this.statisticalService.getRevenueByYear(this.year).subscribe(revenue => {\n        this.revenueYearNow = revenue;\n      });\n      this.statisticalService.getRevenueByMonth(this.year, this.month).subscribe(revenue => {\n        this.revenueMonthNow = revenue;\n      });\n      this.statisticalService.getRevenueByDay(this.year, this.month, this.day).subscribe(revenue => {\n        this.revenueDayNow = revenue;\n      });\n    }\n    loadYears() {\n      this.statisticalService.getCountYear().subscribe(years => {\n        this.countYears = years;\n      });\n    }\n    updateChart(period) {\n      if (period === 'year') {\n        this.statisticalService.getRevenueByYearDetails(this.year).subscribe(data => {\n          this.labels = data.map(item => `Tháng ${item.month}`);\n          this.data = data.map(item => item.amount || 0); // Điền 0 nếu không có dữ liệu\n          this.renderChart();\n        });\n      } else if (period === 'month') {\n        this.statisticalService.getRevenueByMonthDetails(this.year, this.month).subscribe(data => {\n          this.labels = data.map(item => `Ngày ${item.day}`);\n          this.data = data.map(item => item.amount || 0); // Điền 0 nếu không có dữ liệu\n          this.renderChart();\n        });\n      } else if (period === 'day') {\n        this.statisticalService.getRevenueByDayDetails(this.year, this.month, this.day).subscribe(data => {\n          console.log('Dữ liệu nhận được từ API:', data);\n          // Tạo nhãn (labels) từ 0h đến 23h\n          this.labels = Array.from({\n            length: 24\n          }, (_, i) => `${i}h`);\n          // Điền dữ liệu với giá trị amount từ API\n          this.data = data.map(item => item.amount || 0);\n          // Render lại biểu đồ\n          this.renderChart();\n        });\n      }\n    }\n    selectYear(year) {\n      this.year = year;\n      this.updateChart('year');\n    }\n    getAllOrder() {\n      this.orderService.get().subscribe(data => {\n        this.orders = data;\n        this.orderHandle = 0;\n        for (let i = 0; i < this.orders.length; i++) {\n          if (this.orders[i].status == 0) {\n            this.orderHandle++;\n          }\n        }\n      }, error => {\n        this.toastr.error('Lỗi server', 'Hệ thống');\n      });\n    }\n    getAllCustomer() {\n      this.customerService.getAll().subscribe(data => {\n        this.customers = data;\n        this.customerLength = this.customers.length;\n      }, error => {\n        this.toastr.error('Lỗi server', 'Hệ thống');\n      });\n    }\n    renderChart() {\n      const ctx = document.getElementById('chart');\n      if (this.myChart) {\n        // Kiểm tra nếu biểu đồ đã tồn tại, hủy bỏ nó trước khi tạo lại\n        this.myChart.destroy();\n      }\n      // Tạo lại biểu đồ mới với dữ liệu mới\n      this.myChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n          labels: this.labels,\n          datasets: [{\n            label: 'Doanh thu',\n            data: this.data,\n            borderColor: '#2575fc',\n            backgroundColor: 'rgba(37, 117, 252, 0.2)',\n            fill: true,\n            tension: 0.3,\n            pointBackgroundColor: '#2575fc',\n            pointRadius: 5,\n            pointHoverRadius: 8,\n            datalabels: {\n              display: false // Ẩn nhãn hiển thị trên điểm\n            }\n          }]\n        },\n        options: {\n          responsive: true,\n          scales: {\n            y: {\n              beginAtZero: true // Đảm bảo trục Y bắt đầu từ 0\n            },\n            x: {\n              // Đảm bảo các nhãn trên trục X hiển thị đúng\n              ticks: {\n                autoSkip: true // Tự động bỏ qua một số nhãn nếu quá nhiều\n                // maxTicksLimit: 20, // Giới hạn số lượng nhãn hiển thị\n              }\n            }\n          },\n          plugins: {\n            tooltip: {\n              enabled: true,\n              bodyFont: {\n                size: 12,\n                lineHeight: 1.2\n              },\n              callbacks: {\n                label: function (context) {\n                  // Ép kiểu amount thành number trước khi sử dụng\n                  const amount = Number(context.raw); // Lấy giá trị doanh thu\n                  const formattedAmount = new Intl.NumberFormat('vi-VN', {\n                    style: 'currency',\n                    currency: 'VND',\n                    currencyDisplay: 'code',\n                    minimumFractionDigits: 0 // Không hiển thị phần thập phân\n                  }).format(amount); // Định dạng tiền tệ theo định dạng Việt Nam\n                  return `Doanh thu: ${formattedAmount}`; // Hiển thị VNĐ sau số tiền\n                }\n              }\n            },\n            legend: {\n              display: true,\n              position: 'top'\n            }\n          },\n          interaction: {\n            mode: 'index',\n            intersect: false\n          },\n          maintainAspectRatio: false // Bỏ tỷ lệ mặc định của biểu đồ\n        }\n      });\n      // Cập nhật biểu đồ sau khi render lại\n      this.myChart.update();\n    }\n    openWebSocket() {\n      this.webSocket = new WebSocket('ws://localhost:8080/notification');\n      this.webSocket.onopen = event => {\n        // console.log('Open: ', event);\n      };\n      this.webSocket.onmessage = event => {\n        this.getAllOrder();\n      };\n      this.webSocket.onclose = event => {\n        // console.log('Close: ', event);\n      };\n    }\n    closeWebSocket() {\n      this.webSocket.close();\n    }\n  }\n  DashboardComponent_Admin.ɵfac = function DashboardComponent_Admin_Factory(t) {\n    return new (t || DashboardComponent_Admin)(i0.ɵɵdirectiveInject(i1.PageService), i0.ɵɵdirectiveInject(i2.ToastrService), i0.ɵɵdirectiveInject(i3.OrderService), i0.ɵɵdirectiveInject(i4.CustomerService), i0.ɵɵdirectiveInject(i5.StatisticalService));\n  };\n  DashboardComponent_Admin.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: DashboardComponent_Admin,\n    selectors: [[\"app-dashboard\"]],\n    decls: 69,\n    vars: 14,\n    consts: [[1, \"container-fluid\"], [1, \"d-flex\", \"align-items-center\", \"justify-content-between\", \"mb-4\"], [1, \"h3\", \"mb-0\", \"text-gray-800\"], [1, \"row\", \"g-4\"], [1, \"col-xl-3\", \"col-lg-6\", \"col-md-6\"], [1, \"card\", \"border-left-primary\", \"shadow\", \"h-100\", \"py-2\"], [1, \"card-body\"], [1, \"d-flex\", \"align-items-center\"], [1, \"flex-grow-1\"], [1, \"text-xs\", \"font-weight-bold\", \"text-primary\", \"text-uppercase\", \"mb-1\"], [1, \"h5\", \"mb-0\", \"font-weight-bold\", \"text-gray-800\"], [1, \"ms-3\"], [1, \"fas\", \"fa-calendar\", \"fa-2x\", \"text-gray-300\"], [1, \"card\", \"border-left-success\", \"shadow\", \"h-100\", \"py-2\"], [1, \"text-xs\", \"font-weight-bold\", \"text-success\", \"text-uppercase\", \"mb-1\"], [1, \"fas\", \"fa-dollar-sign\", \"fa-2x\", \"text-gray-300\"], [1, \"card\", \"border-left-info\", \"shadow\", \"h-100\", \"py-2\"], [1, \"text-xs\", \"font-weight-bold\", \"text-info\", \"text-uppercase\", \"mb-1\"], [1, \"fas\", \"fa-user\", \"fa-2x\", \"text-gray-300\", 2, \"cursor\", \"pointer\", 3, \"routerLink\"], [1, \"card\", \"border-left-warning\", \"shadow\", \"h-100\", \"py-2\"], [1, \"text-xs\", \"font-weight-bold\", \"text-warning\", \"text-uppercase\", \"mb-1\"], [1, \"fas\", \"fa-shopping-cart\", \"fa-2x\", \"text-gray-300\", 2, \"cursor\", \"pointer\", 3, \"routerLink\"], [1, \"row\", \"mt-4\"], [1, \"d-flex\", \"align-items-center\", \"justify-content-start\"], [1, \"dropdown\", \"me-3\"], [\"type\", \"button\", \"id\", \"dropdownYear\", \"data-bs-toggle\", \"dropdown\", \"aria-expanded\", \"false\", 1, \"btn\", \"btn-secondary\", \"dropdown-toggle\"], [\"aria-labelledby\", \"dropdownYear\", 1, \"dropdown-menu\"], [4, \"ngFor\", \"ngForOf\"], [1, \"d-flex\"], [1, \"btn\", \"btn-outline-primary\", \"me-2\", 3, \"click\"], [1, \"btn\", \"btn-outline-primary\", 3, \"click\"], [1, \"col-lg-12\"], [\"id\", \"divChart\", 1, \"bg-white\", \"p-3\", \"rounded\", \"shadow-sm\"], [\"id\", \"chart\", 2, \"height\", \"400px\", \"max-width\", \"100%\"], [1, \"dropdown-item\", 3, \"click\"]],\n    template: function DashboardComponent_Admin_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"h1\", 2);\n        i0.ɵɵtext(3, \"Trang ch\\u1EE7\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵelementStart(5, \"div\", 4);\n        i0.ɵɵelementStart(6, \"div\", 5);\n        i0.ɵɵelementStart(7, \"div\", 6);\n        i0.ɵɵelementStart(8, \"div\", 7);\n        i0.ɵɵelementStart(9, \"div\", 8);\n        i0.ɵɵelementStart(10, \"div\", 9);\n        i0.ɵɵtext(11, \" Doanh thu (th\\u00E1ng) \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"div\", 10);\n        i0.ɵɵtext(13);\n        i0.ɵɵpipe(14, \"currencyVietnam\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"div\", 11);\n        i0.ɵɵelement(16, \"i\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"div\", 4);\n        i0.ɵɵelementStart(18, \"div\", 13);\n        i0.ɵɵelementStart(19, \"div\", 6);\n        i0.ɵɵelementStart(20, \"div\", 7);\n        i0.ɵɵelementStart(21, \"div\", 8);\n        i0.ɵɵelementStart(22, \"div\", 14);\n        i0.ɵɵtext(23, \" Doanh thu (n\\u0103m) \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"div\", 10);\n        i0.ɵɵtext(25);\n        i0.ɵɵpipe(26, \"currencyVietnam\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"div\", 11);\n        i0.ɵɵelement(28, \"i\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"div\", 4);\n        i0.ɵɵelementStart(30, \"div\", 16);\n        i0.ɵɵelementStart(31, \"div\", 6);\n        i0.ɵɵelementStart(32, \"div\", 7);\n        i0.ɵɵelementStart(33, \"div\", 8);\n        i0.ɵɵelementStart(34, \"div\", 17);\n        i0.ɵɵtext(35, \" Kh\\u00E1ch h\\u00E0ng \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"div\", 10);\n        i0.ɵɵtext(37);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(38, \"div\", 11);\n        i0.ɵɵelement(39, \"i\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(40, \"div\", 4);\n        i0.ɵɵelementStart(41, \"div\", 19);\n        i0.ɵɵelementStart(42, \"div\", 6);\n        i0.ɵɵelementStart(43, \"div\", 7);\n        i0.ɵɵelementStart(44, \"div\", 8);\n        i0.ɵɵelementStart(45, \"div\", 20);\n        i0.ɵɵtext(46, \" \\u0110\\u01A1n h\\u00E0ng c\\u1EA7n x\\u1EED l\\u00FD \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(47, \"div\", 10);\n        i0.ɵɵtext(48);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(49, \"div\", 11);\n        i0.ɵɵelement(50, \"i\", 21);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(51, \"div\", 22);\n        i0.ɵɵelementStart(52, \"div\", 23);\n        i0.ɵɵelementStart(53, \"div\", 24);\n        i0.ɵɵelementStart(54, \"button\", 25);\n        i0.ɵɵtext(55);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(56, \"ul\", 26);\n        i0.ɵɵtemplate(57, DashboardComponent_Admin_li_57_Template, 3, 3, \"li\", 27);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(58, \"div\", 28);\n        i0.ɵɵelementStart(59, \"button\", 29);\n        i0.ɵɵlistener(\"click\", function DashboardComponent_Admin_Template_button_click_59_listener() {\n          return ctx.updateChart(\"year\");\n        });\n        i0.ɵɵtext(60, \"Theo n\\u0103m\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(61, \"button\", 29);\n        i0.ɵɵlistener(\"click\", function DashboardComponent_Admin_Template_button_click_61_listener() {\n          return ctx.updateChart(\"month\");\n        });\n        i0.ɵɵtext(62, \"Theo th\\u00E1ng\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(63, \"button\", 30);\n        i0.ɵɵlistener(\"click\", function DashboardComponent_Admin_Template_button_click_63_listener() {\n          return ctx.updateChart(\"day\");\n        });\n        i0.ɵɵtext(64, \"Theo ng\\u00E0y\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(65, \"div\", 22);\n        i0.ɵɵelementStart(66, \"div\", 31);\n        i0.ɵɵelementStart(67, \"div\", 32);\n        i0.ɵɵelement(68, \"canvas\", 33);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(13);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(14, 8, ctx.revenueMonthNow), \" \");\n        i0.ɵɵadvance(12);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(26, 10, ctx.revenueYearNow), \" \");\n        i0.ɵɵadvance(12);\n        i0.ɵɵtextInterpolate1(\" \", ctx.customerLength, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(12, _c0));\n        i0.ɵɵadvance(9);\n        i0.ɵɵtextInterpolate1(\" \", ctx.orderHandle, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(13, _c1));\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\" N\\u0103m: \", ctx.year, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.countYears);\n      }\n    },\n    directives: [i6.RouterLink, i7.NgForOf],\n    pipes: [i8.CurrencyVietnamPipe],\n    styles: [\".card[_ngcontent-%COMP%]{border-left:4px solid #0000;border-radius:.5rem}.border-left-primary[_ngcontent-%COMP%]{border-left-color:#4e73df}.border-left-success[_ngcontent-%COMP%]{border-left-color:#1cc88a}.border-left-info[_ngcontent-%COMP%]{border-left-color:#36b9cc}.border-left-warning[_ngcontent-%COMP%]{border-left-color:#f6c23e}.text-primary[_ngcontent-%COMP%]{color:#4e73df!important}.text-success[_ngcontent-%COMP%]{color:#1cc88a!important}.text-info[_ngcontent-%COMP%]{color:#36b9cc!important}.text-warning[_ngcontent-%COMP%]{color:#f6c23e!important}.card[_ngcontent-%COMP%]:hover{transform:scale(1.05);transition:transform .2s ease-in-out}#divChart[_ngcontent-%COMP%]{position:relative;height:40vh;min-height:200px;background:#f9f9f9;border-radius:8px;box-shadow:0 2px 5px #0000001a;padding:1rem}canvas[_ngcontent-%COMP%]{display:block;width:100%;height:100%!important;object-fit:contain}\"]\n  });\n  return DashboardComponent_Admin;\n})();","map":null,"metadata":{},"sourceType":"module"}