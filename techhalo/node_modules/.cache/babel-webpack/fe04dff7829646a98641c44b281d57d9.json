{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i2 from \"../../services_admin/supplier.service\";\nimport * as i3 from \"../../services_admin/upload.service\";\nimport * as i4 from \"ngx-toastr\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/button\";\nconst _c0 = function (a0) {\n  return {\n    \"is-invalid\": a0\n  };\n};\nfunction EditSupplierComponent_Admin_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵelementStart(1, \"h2\", 4);\n    i0.ɵɵtext(2, \"C\\u1EADp nh\\u1EADt th\\u00F4ng tin nh\\u00E0 cung c\\u1EA5p\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 5);\n    i0.ɵɵelementStart(4, \"form\", 6);\n    i0.ɵɵelement(5, \"input\", 7);\n    i0.ɵɵelementStart(6, \"div\", 8);\n    i0.ɵɵelementStart(7, \"label\", 9);\n    i0.ɵɵtext(8, \"T\\u00EAn nh\\u00E0 cung c\\u1EA5p:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"input\", 10);\n    i0.ɵɵelementStart(10, \"small\", 11);\n    i0.ɵɵtext(11, \"H\\u00E3y nh\\u1EADp t\\u00EAn nh\\u00E0 cung c\\u1EA5p\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 8);\n    i0.ɵɵelementStart(13, \"label\", 12);\n    i0.ɵɵtext(14, \"\\u0110\\u1ECBa ch\\u1EC9:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(15, \"input\", 13);\n    i0.ɵɵelementStart(16, \"small\", 11);\n    i0.ɵɵtext(17, \"H\\u00E3y nh\\u1EADp \\u0111\\u1ECBa ch\\u1EC9 h\\u1EE3p l\\u1EC7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"div\", 8);\n    i0.ɵɵelementStart(19, \"label\", 14);\n    i0.ɵɵtext(20, \"Email:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(21, \"input\", 15);\n    i0.ɵɵelementStart(22, \"small\", 11);\n    i0.ɵɵtext(23, \"H\\u00E3y nh\\u1EADp email \\u0111\\u00FAng \\u0111\\u1ECBnh d\\u1EA1ng\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"div\", 8);\n    i0.ɵɵelementStart(25, \"label\", 16);\n    i0.ɵɵtext(26, \"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(27, \"input\", 17);\n    i0.ɵɵelementStart(28, \"small\", 11);\n    i0.ɵɵtext(29, \"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i ph\\u1EA3i c\\u00F3 10-11 ch\\u1EEF s\\u1ED1\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"div\", 8);\n    i0.ɵɵelementStart(31, \"label\", 18);\n    i0.ɵɵtext(32, \"Ng\\u00E0y t\\u1EA1o:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(33, \"input\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"div\", 20);\n    i0.ɵɵelementStart(35, \"h3\");\n    i0.ɵɵtext(36, \"H\\u00ECnh \\u1EA3nh nh\\u00E0 cung c\\u1EA5p\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"div\", 21);\n    i0.ɵɵelementStart(38, \"div\", 22);\n    i0.ɵɵelement(39, \"img\", 23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"div\", 24);\n    i0.ɵɵelementStart(41, \"input\", 25);\n    i0.ɵɵlistener(\"change\", function EditSupplierComponent_Admin_ng_template_0_Template_input_change_41_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.onFileSelect($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(42, \"label\", 26);\n    i0.ɵɵtext(43, \"Ch\\u1ECDn \\u1EA3nh\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(44, \"button\", 27);\n    i0.ɵɵlistener(\"click\", function EditSupplierComponent_Admin_ng_template_0_Template_button_click_44_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.update();\n    });\n    i0.ɵɵtext(45, \"C\\u1EADp nh\\u1EADt\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    let tmp_1_0;\n    let tmp_2_0;\n    let tmp_3_0;\n    let tmp_4_0;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.postForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(7, _c0, ((tmp_1_0 = ctx_r1.postForm.get(\"name\")) == null ? null : tmp_1_0.touched) && ((tmp_1_0 = ctx_r1.postForm.get(\"name\")) == null ? null : tmp_1_0.invalid)));\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(9, _c0, ((tmp_2_0 = ctx_r1.postForm.get(\"address\")) == null ? null : tmp_2_0.touched) && ((tmp_2_0 = ctx_r1.postForm.get(\"address\")) == null ? null : tmp_2_0.invalid)));\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(11, _c0, ((tmp_3_0 = ctx_r1.postForm.get(\"email\")) == null ? null : tmp_3_0.touched) && ((tmp_3_0 = ctx_r1.postForm.get(\"email\")) == null ? null : tmp_3_0.invalid)));\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(13, _c0, ((tmp_4_0 = ctx_r1.postForm.get(\"phone\")) == null ? null : tmp_4_0.touched) && ((tmp_4_0 = ctx_r1.postForm.get(\"phone\")) == null ? null : tmp_4_0.invalid)));\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"src\", ctx_r1.image, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.postForm.invalid);\n  }\n}\nexport let EditSupplierComponent_Admin = /*#__PURE__*/(() => {\n  class EditSupplierComponent_Admin {\n    constructor(modalService, supplierService, uploadService, toastr) {\n      this.modalService = modalService;\n      this.supplierService = supplierService;\n      this.uploadService = uploadService;\n      this.toastr = toastr;\n      this.image = 'https://res.cloudinary.com/techhalo/image/upload/v1730101458/ry8qchrwe6iizswfcagi.jpg'; // Ảnh mặc định\n      this.id = 0; // Nhận ID nhà cung cấp từ component cha\n      this.editFinish = new EventEmitter();\n    }\n    ngOnInit() {\n      this.initializeForm(); // Khởi tạo form rỗng\n      this.getSupplier(); // Lấy dữ liệu nhà cung cấp\n      this.loadSuppliers(); // Lấy danh sách nhà cung cấp để kiểm tra tên\n    }\n    // Khởi tạo form với các trường cần thiết\n    initializeForm() {\n      this.postForm = new FormGroup({\n        supplierId: new FormControl(0),\n        name: new FormControl(null, [Validators.required, Validators.minLength(2)]),\n        address: new FormControl(null, [Validators.required, Validators.minLength(2)]),\n        email: new FormControl(null, [Validators.required, Validators.email]),\n        phone: new FormControl(null, [Validators.required, Validators.pattern('^[0-9]{10,11}$')]),\n        image: new FormControl(this.image),\n        create_at: new FormControl(null) // Ngày tạo\n      });\n    }\n    // Lấy thông tin nhà cung cấp theo ID\n    getSupplier() {\n      this.supplierService.getOne(this.id).subscribe(data => {\n        this.supplier = data;\n        this.image = this.supplier.image || this.image; // Cập nhật ảnh hoặc giữ ảnh mặc định\n        this.postForm.patchValue({\n          supplierId: this.supplier.supplierId,\n          name: this.supplier.name,\n          address: this.supplier.address,\n          email: this.supplier.email,\n          phone: this.supplier.phone,\n          image: this.image,\n          create_at: this.supplier.create_at\n        });\n      }, error => {\n        this.modalService.dismissAll();\n        this.toastr.error('Lỗi! Không tìm thấy nhà cung cấp. ' + error, 'Hệ thống');\n      });\n    }\n    // Lấy tất cả nhà cung cấp để kiểm tra tên\n    loadSuppliers() {\n      this.supplierService.getAll().subscribe(data => {\n        this.suppliers = data; // Giả sử dữ liệu trả về là một mảng các Supplier\n      }, error => {\n        this.toastr.error('Lỗi khi tải nhà cung cấp!', 'Hệ thống');\n      });\n    }\n    // Kiểm tra xem tên nhà cung cấp đã tồn tại chưa\n    isSupplierNameExist(name) {\n      return this.suppliers.some(supplier => supplier.name.toLowerCase() === name.toLowerCase() && supplier.supplierId !== this.id);\n    }\n    // Cập nhật thông tin nhà cung cấp\n    update() {\n      if (this.postForm.valid) {\n        const supplierData = this.postForm.value;\n        // Kiểm tra tên nhà cung cấp có tồn tại hay không\n        if (this.isSupplierNameExist(supplierData.name)) {\n          this.toastr.warning('Tên nhà cung cấp này đã tồn tại!', 'Thông báo');\n          return;\n        }\n        // Gửi yêu cầu cập nhật nhà cung cấp\n        this.supplierService.put(this.id, supplierData).subscribe(() => {\n          this.modalService.dismissAll();\n          this.toastr.success('Cập nhật thành công!', 'Hệ thống');\n          this.editFinish.emit('done'); // Emit sự kiện để thông báo cập nhật hoàn tất\n        }, error => {\n          this.toastr.error('Cập nhật thất bại! ' + error, 'Hệ thống');\n        });\n      } else {\n        this.toastr.error('Vui lòng kiểm tra lại thông tin!', 'Hệ thống');\n      }\n    }\n    // Phương thức tải lên ảnh\n    onFileSelect(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      this.uploadService.uploadProduct(file).subscribe(response => {\n        if (response && response.secure_url) {\n          this.image = response.secure_url; // Cập nhật URL ảnh\n          this.postForm.patchValue({\n            image: this.image\n          }); // Gán URL vào form\n        }\n      }, error => {\n        this.toastr.error('Lỗi khi tải lên hình ảnh!', 'Hệ thống');\n      });\n    }\n    // Mở modal chỉnh sửa\n    open(content) {\n      this.modalService.open(content, {\n        centered: true,\n        size: 'lg'\n      });\n    }\n  }\n  EditSupplierComponent_Admin.ɵfac = function EditSupplierComponent_Admin_Factory(t) {\n    return new (t || EditSupplierComponent_Admin)(i0.ɵɵdirectiveInject(i1.NgbModal), i0.ɵɵdirectiveInject(i2.SupplierService), i0.ɵɵdirectiveInject(i3.UploadService), i0.ɵɵdirectiveInject(i4.ToastrService));\n  };\n  EditSupplierComponent_Admin.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EditSupplierComponent_Admin,\n    selectors: [[\"app-edit-supplier\"]],\n    inputs: {\n      id: \"id\"\n    },\n    outputs: {\n      editFinish: \"editFinish\"\n    },\n    decls: 4,\n    vars: 0,\n    consts: [[\"content\", \"\"], [2, \"color\", \"steelblue\", \"cursor\", \"pointer\", 3, \"click\"], [1, \"fas\", \"fa-edit\"], [1, \"modal-header\"], [1, \"modal-title\", \"m-0\"], [1, \"modal-body\", \"p-4\"], [3, \"formGroup\"], [\"type\", \"hidden\", \"formControlName\", \"supplierId\"], [1, \"form-group\", \"mb-3\"], [\"for\", \"name\", 1, \"form-label\"], [\"type\", \"text\", \"id\", \"name\", \"placeholder\", \"T\\u00EAn nh\\u00E0 cung c\\u1EA5p\", \"formControlName\", \"name\", 1, \"form-control\", 3, \"ngClass\"], [1, \"invalid-feedback\"], [\"for\", \"address\", 1, \"form-label\"], [\"type\", \"text\", \"id\", \"address\", \"placeholder\", \"\\u0110\\u1ECBa ch\\u1EC9\", \"formControlName\", \"address\", 1, \"form-control\", 3, \"ngClass\"], [\"for\", \"email\", 1, \"form-label\"], [\"type\", \"email\", \"id\", \"email\", \"placeholder\", \"Email\", \"formControlName\", \"email\", 1, \"form-control\", 3, \"ngClass\"], [\"for\", \"phone\", 1, \"form-label\"], [\"type\", \"text\", \"id\", \"phone\", \"placeholder\", \"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\", \"formControlName\", \"phone\", 1, \"form-control\", 3, \"ngClass\"], [\"for\", \"create_at\", 1, \"form-label\"], [\"type\", \"date\", \"id\", \"create_at\", \"formControlName\", \"create_at\", \"readonly\", \"\", 1, \"form-control\"], [1, \"form-group\", \"text-center\"], [1, \"image-container\"], [1, \"main-image-wrapper\"], [\"alt\", \"H\\u00ECnh \\u1EA3nh nh\\u00E0 cung c\\u1EA5p\", 1, \"img-fluid\", \"main-image\", 3, \"src\"], [1, \"custom-file\", \"col-4\", \"mt-2\"], [\"type\", \"file\", \"id\", \"imageFile\", 1, \"custom-file-input\", 3, \"change\"], [\"for\", \"imageFile\", 1, \"custom-file-label\", \"form-control\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"disabled\", \"click\"]],\n    template: function EditSupplierComponent_Admin_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r7 = i0.ɵɵgetCurrentView();\n        i0.ɵɵtemplate(0, EditSupplierComponent_Admin_ng_template_0_Template, 46, 15, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementStart(2, \"a\", 1);\n        i0.ɵɵlistener(\"click\", function EditSupplierComponent_Admin_Template_a_click_2_listener() {\n          i0.ɵɵrestoreView(_r7);\n          const _r0 = i0.ɵɵreference(1);\n          return ctx.open(_r0);\n        });\n        i0.ɵɵelement(3, \"i\", 2);\n        i0.ɵɵelementEnd();\n      }\n    },\n    directives: [i5.ɵNgNoValidate, i5.NgControlStatusGroup, i5.FormGroupDirective, i5.DefaultValueAccessor, i5.NgControlStatus, i5.FormControlName, i6.NgClass, i7.MatButton],\n    styles: [\".image-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:20px 0}.main-image-wrapper[_ngcontent-%COMP%]{max-width:200px;margin-bottom:15px}.main-image[_ngcontent-%COMP%]{width:100%;object-fit:contain}\"]\n  });\n  return EditSupplierComponent_Admin;\n})();","map":null,"metadata":{},"sourceType":"module"}